<!doctype html>
<html>
<head>
<meta charset="utf-8">
</head>
<body>
Hi...
<ul id="msg-list">

</ul>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/socket.io-1.1.0.js"></script>
<script>
var socket = io('http://192.168.1.170:8084/slave');
var GAME = {
    'user' : null
};
socket.on('connect', function(){
    socket.emit('enter_game', 'hello');
    
    //发起攻击
    var attack = function(){
        var shapeid = Math.floor(Math.random() * 8 + 1); //生成 1 - 9的符文
        var msg = {
          "action": "ms-attack",
          "data": {
            "channel": 1, // 进入频道号
            "shape_type": shapeid, // 形状id
            "userid": GAME.user.userid // 用户id
          }
        };
        console.log(msg);
        var html = "<li> attack use shape : " + shapeid + "</li>";
        socket.emit(msg.action, msg);
        $("#msg-list").append(html);
    };
    
    //模拟攻击
    var attack_count = 0;
    var timer = setInterval(function(){
        attack_count++;
        attack();
        if(attack_count == 2){
            clearInterval(timer);
            var html = "<li> attack done. </li>";
            $("#msg-list").append(html);
        }
    }, 3000);
});


//欢迎消息
socket.on('sm-welcome', function(msg){
    console.log(msg);
    GAME.user = msg.data.user;
    var html = "<li> i am the slave : " + JSON.stringify(GAME.user) +
        "</li>";
    $("#msg-list").append(html);
    $("#msg-list").append("<li> my hero : " + JSON.stringify(msg.data.hero) + "</li>");
});

//攻击完成，server 端返回的消息
socket.on('sm-attack', function(msg){
    console.log(msg);
    var boss = msg.data;
    var html = "<li>boss was attacked.." + JSON.stringify(msg.data) +
        "</li>";
    $("#msg-list").append(html);
});

</script>
</body>
</html>